---
layout : post
title :  2020-11-30 TIL
categories : TIL
layout : single
toc : true 
toc_sticky : true
---



# 멀티파트



#### acid test

- html, css 문법을 웹브라우저가 얼마나 지원하는지 확인하는 테스트
- https://www.acidtests.org/



### GET / POST

- GET
  - 주소창에 주소를 넣고 보냈을 때
  - 링크를 눌렀을 때
  - 입력폼의 타입이 get인 상태에서 값을 넣고 전송을 눌렀을 때(form은 기본적으로 get 요청을 보낸다. post 요청을 보내고 싶을때는 form의 메서드를 post로 지정해 줘야 한다.)
    - 전부 쿼리 스트링을 보낸다.
- POST
  - 입력폼의 method가 post라고 지정한다.]
  - post 요청은 주소에 쿼리 스트링이 붙지 않는다.
    - 데이터를 서버에 보낼 때 
      - 리퀘스트 라인은 post
      - 주소
      - 헤더
      - 빈줄 
      - 메세지 바디 <- 데이터는 메세지 바디를 통해서 보낸다.
- 서버에서 데이터를 꺼낼때는 전부 getParameter("변수명")으로 꺼낸다.
- 리턴값은 무조건 String이다
- 숫자를 문자로 받았을 때 다시 숫자로 바꾸고 싶은 때는 Integer를 사용한다.



### 파일 업로드

- 상대 경로("s3")를 준다. / 절대 경로("/eomcs-java-seb/ex04/s3")
  - 웹 브라우저에서 바라보는 루트는 무조건 서버 루트이다.
  - 웹 브라우저에게 쓰라고 알려주는 루트 역시 무조건 서버 루트이다.
    - /eomcs-java-ser/ex04/s3
  - 서블릿에서 바라보는 루트는 컨텍스트(웹 어플리케이션) 루트이다.
  - 서블릿 컨테이너에게 알려주는 루트는 컨텍스트 루트이다.
    - /ex04/s3
- get 요청으로 보냈을 때
  - file을 업로드 한다면 file 자체가 서버에 가야 하는데 file 이름만 보내게 된다.
- post 요청으로 보냈을 때
  - 일반적인 post 요청 역시 file을 업로드 할 수 없다.
  - 웹 브라우저에서 파일을 보낼때는 자동으로 서버에 파일을 보낼 수 없다.
    - 해킹의 가능성이 있기 때문에
      - 예) 액티브X
    - 무조건 사용자가 승인을 한 파일만 서버에 보낼 수 있다.
    - 서버에 파일을 보내는 게 아니라 메세지 바디를 통해 이름만 보낸다.
    - 일반 포스트가 아니라 mulipart/form-data 형식으로 보내야 파일이 서버에 업로드 된다.
      - Enctype-"multipart/form-data" method="post"
    - Boundary WebkitformBoundary < 파일 구분자
    - 오리지날 파일 명도 서버에 보내고 바이너리 데이터 역시 서버에 보낸다.
      - 서블릿에서 멀티파트로 보내진 데이터를 처리하지 못하기 때문에 getParameter로 바이너리 데이터를 꺼낼 수 없다.
        - apache에서 라이브러리를 만들어서 배포
          - 'commons-fileupload'



### commons fileupload

- Multipart 형식으로 보낸 첨부 파일 데이터를 읽는 방법
  - Content-type 헤더에 지정한 구분자를 사용하여 각 파트를 분리한 다음 데이터를 읽는다.
  - 기존에 제공하는 getParameter()로는 멀티파트 형식으로 전송된 데이터를 읽을 수 없다.
    - 방법?
      - 외부 라이브러리를 사용한다.
      - Apache.org 사이트에서 제공하는 멀티파트 데이터 분석기를 사용한다.
      - Servlet 3.0부터는 서블릿에서 제공하는 기능을 이용한다.
        - 실무에서는 commons-fileupload 방식도 많이 사용한다.
  - 멀티 파트 형식의 데이터를 처리할때는 인코딩 설정이 적용되지 않는다.
  - getParameter()도 적용되지 않는다.
  - Common-fileupload 문서에 따라 코딩한다.
    - 멀티파트 데이터를 분석하여 fileItem 객체에 담아줄 공장을 준비한다.
    - 공장 객체를 사용하여 클라이언트가 보낸 데이터를 처리할 객체 준비한다.
    - 파트의 데이터가 일반 데이터라면 클라이언트가 보낸 파라미터 이름과 파라미터의 값을 꺼낼 때 인코딩을 지정해서 맵에 저장한다.
    - 만약 데이터가 파일아라면
      - 임의의 파일 이름으로 저장하도록 UUID.randomUUID를 사용하고
      - 클라이언트가 보낸 파라미터 이름
      - 파라미터의 값. 값 꺼낼 때 인코딩을 지정해야 한다.



#### 서버나 DBMS를 공유?

- DBMS를 공유한다면 Storage를 만들어서 업로드 한 파일 역시 공유해야 한다.
  - 실무에서 서버가 여러개일때
    - 같은 스토리지와 DBMS를 바라본다.



#### 업로드 파일을 다르게 저장하고 싶을 때

- Upload/board, upload/member 이런 식으로 나눠서 저장하면 된다.





